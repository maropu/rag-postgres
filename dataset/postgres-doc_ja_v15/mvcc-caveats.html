<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>13.6. 警告</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="mvcc-serialization-failure-handling.html" title="13.5. 直列化失敗の扱い" /><link rel="next" href="locking-indexes.html" title="13.7. ロックとインデックス" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /><style type="text/css"><!--
h1.TITLE {clear:both;}
.versions {
  float:right;
  margin-top:-0.2em;
  margin-bottom:0.5em;
  width: auto;
  padding:0.4em 1em;
  border:solid 1px #e0e0e0;
  border-radius:0.5em;
  background:#f3f3f3;
  background-image:-webkit-linear-gradient(#fbfbfb, #ebebeb);
  background-image:-moz-linear-gradient(#fbfbfb, #ebebeb);
  background-image:-o-linear-gradient(#fbfbfb, #ebebeb);
  background-image:linear-gradient(#fbfbfb, #ebebeb);
  box-shadow:0 3px 8px -3px #000;
}
.versions .label {
  cursor:pointer;
}
.versions .label:hover {
  text-decoration:underline;
}
.versions .list {
  display:none;
}
.versions .list-toggle {
  display:inline;
}
.versions .me {
  padding:0 0.2em;
  border:solid 2px #e88;
  border-radius:0.3em;
  background:#fbfbfb;
  font-weight:bold;
}
.versions .other {
  font-weight:bold;
}
.versions .unsup {
  color:#aaa;
}
.versions .unsup a {
  color:#aaa;
}

@media print {
  a {
    color: inherit;
    text-decoration: none;
  }
  a:visited {
    color: inherit;
  }
  .NAVHEADER, .versions, .NAVFOOTER {
    display: none;
  }
}
--></style><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript"><!--
  $(function(){
      $(".versions .label").bind("click", function(){
          $(".versions .list").toggleClass("list-toggle");
      })
  });
--></script></head><body id="docContent" class="container-fluid col-10"><div class="versions"><span class="label">他のバージョンの文書</span> <span class="list">： <span class="me">15</span> | <span class="other"><a href="/document/14/html/mvcc-caveats.html">14</a><span> | <span class="other"><a href="/document/13/html/mvcc-caveats.html">13</a><span> | <span class="other"><a href="/document/12/html/mvcc-caveats.html">12</a><span> | <span class="other"><a href="/document/11/html/mvcc-caveats.html">11</a><span> | <span class="other"><a href="/document/10/html/mvcc-caveats.html">10</a><span> | <span class="other"><a href="/document/9.6/html/mvcc-caveats.html">9.6</a><span> | <span class="other"><a href="/document/9.5/html/mvcc-caveats.html">9.5</a><span> | <span class="other"><a href="/document/9.4/html/mvcc-caveats.html">9.4</a><span> | <span class="unsup"><a href="/document/9.3/index.html">9.3</a></span> | <span class="unsup"><a href="/document/9.2/index.html">9.2</a></span> | <span class="unsup"><a href="/document/9.1/index.html">9.1</a></span> | <span class="unsup"><a href="/document/9.0/index.html">9.0</a></span> | <span class="unsup"><a href="/document/8.4/index.html">8.4</a></span> | <span class="unsup"><a href="/document/8.3/index.html">8.3</a></span> | <span class="unsup"><a href="/document/8.2/index.html">8.2</a></span> | <span class="unsup"><a href="/document/8.1/index.html">8.1</a></span> | <span class="unsup"><a href="/document/8.0/index.html">8.0</a></span> | <span class="unsup"><a href="/document/7.4/index.html">7.4</a></span> | <span class="unsup"><a href="/document/7.3/index.html">7.3</a></span> | <span class="unsup"><a href="/document/7.2/index.html">7.2</a></span></span></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 15.4文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="mvcc.html" title="第13章 同時実行制御">第13章 同時実行制御</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="mvcc-serialization-failure-handling.html" title="13.5. 直列化失敗の扱い">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="mvcc.html" title="第13章 同時実行制御">上へ</a></td><td width="60%" align="center">13.6. 警告</td><td width="20%" align="right"> <a accesskey="n" href="locking-indexes.html" title="13.7. ロックとインデックス">次へ</a></td></tr></table><hr /></div><div class="sect1" id="MVCC-CAVEATS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">13.6. 警告</h2></div></div></div><!--
   <title>Caveats</title>
--><p>
<!--
    Some DDL commands, currently only <link linkend="sql-truncate"><command>TRUNCATE</command></link> and the
    table-rewriting forms of <link linkend="sql-altertable"><command>ALTER TABLE</command></link>, are not
    MVCC-safe.  This means that after the truncation or rewrite commits, the
    table will appear empty to concurrent transactions, if they are using a
    snapshot taken before the DDL command committed.  This will only be an
    issue for a transaction that did not access the table in question
    before the DDL command started &mdash; any transaction that has done so
    would hold at least an <literal>ACCESS SHARE</literal> table lock,
    which would block the DDL command until that transaction completes.
    So these commands will not cause any apparent inconsistency in the
    table contents for successive queries on the target table, but they
    could cause visible inconsistency between the contents of the target
    table and other tables in the database.
-->
DDLコマンドの中には、現在は<a class="link" href="sql-truncate.html" title="TRUNCATE"><code class="command">TRUNCATE</code></a>とテーブルを書き換える形の<a class="link" href="sql-altertable.html" title="ALTER TABLE"><code class="command">ALTER TABLE</code></a>だけですが、MVCCセーフでないものがあります。
これは、DDLコマンドをコミットする前に取得したスナップショットを使っていると、切り詰めまたは書き換えのコミット後に、同時実行トランザクションに対してテーブルが空に見えることを意味しています。
該当するテーブルにDDLコマンドが開始する前にアクセスしなかったトランザクションにとってのみ、これは問題となるでしょう—開始前にアクセスしたトランザクションは少なくとも<code class="literal">ACCESS SHARE</code>テーブルロックを保持しており、そのトランザクションが完了するまでDDLコマンドはブロックされるでしょう。
ですので、対象のテーブルに対する連続した問い合わせで、このコマンドはテーブルの内容の見かけ上の不整合の原因とはなりません。しかし、対象のテーブルとデータベース内の他のテーブルの内容の間の可視の不整合の原因となるかもしれません。
   </p><p>
<!--
    Support for the Serializable transaction isolation level has not yet
    been added to hot standby replication targets (described in
    <xref linkend="hot-standby"/>).  The strictest isolation level currently
    supported in hot standby mode is Repeatable Read.  While performing all
    permanent database writes within Serializable transactions on the
    primary will ensure that all standbys will eventually reach a consistent
    state, a Repeatable Read transaction run on the standby can sometimes
    see a transient state that is inconsistent with any serial execution
    of the transactions on the primary.
-->
シリアライザブルトランザクション分離レベルのサポートは、まだホットスタンバイレプリケーションは対象に加えられていません(<a class="xref" href="hot-standby.html" title="27.4. ホットスタンバイ">27.4</a>で述べます)。
ホットスタンバイモードで現在サポートされた最も厳しい分離レベルはリピータブルリードです。
プライマリ上でシリアライザブルトランザクション中にデータベースに永続的な書き込みを行えば、スタンバイはすべて最終的に一貫した状態に達するだろうということは保証されるでしょうが、スタンバイ上で実行されたリピータブルリードトランザクションは、ときどきプライマリのトランザクションの任意の連続する実行と一致しない過渡状態を見ることがあるでしょう。
   </p><p>
<!--
    Internal access to the system catalogs is not done using the isolation
    level of the current transaction.  This means that newly created database
    objects such as tables are visible to concurrent Repeatable Read and
    Serializable transactions, even though the rows they contain are not.  In
    contrast, queries that explicitly examine the system catalogs don't see
    rows representing concurrently created database objects, in the higher
    isolation levels.
-->
システムカタログへの内部のアクセスは現在のトランザクションの分離レベルを使っては行われません。
これは、テーブルのような新しく作られたデータベースオブジェクトが、たとえシステムカタログが含む行が可視でないとしても、並行するリピータブルリードトランザクションやシリアライザブルトランザクションに対して可視であることを意味します。
対照的に、明示的にシステムカタログを確認する問い合わせは、より高い分離レベルで並行して作られているデータベースオブジェクトを表す行を見ることはできません。
   </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mvcc-serialization-failure-handling.html" title="13.5. 直列化失敗の扱い">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="mvcc.html" title="第13章 同時実行制御">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="locking-indexes.html" title="13.7. ロックとインデックス">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">13.5. 直列化失敗の扱い </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 15.4文書">ホーム</a></td><td width="40%" align="right" valign="top"> 13.7. ロックとインデックス</td></tr></table></div></body></html>