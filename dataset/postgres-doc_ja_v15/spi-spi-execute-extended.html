<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SPI_execute_extended</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="spi-spi-exec.html" title="SPI_exec" /><link rel="next" href="spi-spi-execute-with-args.html" title="SPI_execute_with_args" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /><style type="text/css"><!--
h1.TITLE {clear:both;}
.versions {
  float:right;
  margin-top:-0.2em;
  margin-bottom:0.5em;
  width: auto;
  padding:0.4em 1em;
  border:solid 1px #e0e0e0;
  border-radius:0.5em;
  background:#f3f3f3;
  background-image:-webkit-linear-gradient(#fbfbfb, #ebebeb);
  background-image:-moz-linear-gradient(#fbfbfb, #ebebeb);
  background-image:-o-linear-gradient(#fbfbfb, #ebebeb);
  background-image:linear-gradient(#fbfbfb, #ebebeb);
  box-shadow:0 3px 8px -3px #000;
}
.versions .label {
  cursor:pointer;
}
.versions .label:hover {
  text-decoration:underline;
}
.versions .list {
  display:none;
}
.versions .list-toggle {
  display:inline;
}
.versions .me {
  padding:0 0.2em;
  border:solid 2px #e88;
  border-radius:0.3em;
  background:#fbfbfb;
  font-weight:bold;
}
.versions .other {
  font-weight:bold;
}
.versions .unsup {
  color:#aaa;
}
.versions .unsup a {
  color:#aaa;
}

@media print {
  a {
    color: inherit;
    text-decoration: none;
  }
  a:visited {
    color: inherit;
  }
  .NAVHEADER, .versions, .NAVFOOTER {
    display: none;
  }
}
--></style><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript"><!--
  $(function(){
      $(".versions .label").bind("click", function(){
          $(".versions .list").toggleClass("list-toggle");
      })
  });
--></script></head><body id="docContent" class="container-fluid col-10"><div class="versions"><span class="label">他のバージョンの文書</span> <span class="list">： <span class="me">15</span> | <span class="other"><a href="/document/14/html/spi-spi-execute-extended.html">14</a><span> | <span class="unsup"><a href="/document/13/index.html">13</a></span> | <span class="unsup"><a href="/document/12/index.html">12</a></span> | <span class="unsup"><a href="/document/11/index.html">11</a></span> | <span class="unsup"><a href="/document/10/index.html">10</a></span> | <span class="unsup"><a href="/document/9.6/index.html">9.6</a></span> | <span class="unsup"><a href="/document/9.5/index.html">9.5</a></span> | <span class="unsup"><a href="/document/9.4/index.html">9.4</a></span> | <span class="unsup"><a href="/document/9.3/index.html">9.3</a></span> | <span class="unsup"><a href="/document/9.2/index.html">9.2</a></span> | <span class="unsup"><a href="/document/9.1/index.html">9.1</a></span> | <span class="unsup"><a href="/document/9.0/index.html">9.0</a></span> | <span class="unsup"><a href="/document/8.4/index.html">8.4</a></span> | <span class="unsup"><a href="/document/8.3/index.html">8.3</a></span> | <span class="unsup"><a href="/document/8.2/index.html">8.2</a></span> | <span class="unsup"><a href="/document/8.1/index.html">8.1</a></span> | <span class="unsup"><a href="/document/8.0/index.html">8.0</a></span> | <span class="unsup"><a href="/document/7.4/index.html">7.4</a></span> | <span class="unsup"><a href="/document/7.3/index.html">7.3</a></span> | <span class="unsup"><a href="/document/7.2/index.html">7.2</a></span></span></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 15.4文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="spi-interface.html" title="47.1. インタフェース関数">47.1. インタフェース関数</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="spi-spi-exec.html" title="SPI_exec">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="spi-interface.html" title="47.1. インタフェース関数">上へ</a></td><td width="60%" align="center">SPI_execute_extended</td><td width="20%" align="right"> <a accesskey="n" href="spi-spi-execute-with-args.html" title="SPI_execute_with_args">次へ</a></td></tr></table><hr /></div><div class="refentry" id="SPI-SPI-EXECUTE-EXTENDED"><div class="titlepage"></div><a id="id-1.8.12.8.6.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">SPI_execute_extended</span></h2><p>SPI_execute_extended<!--
  <refpurpose>execute a command with out-of-line parameters</refpurpose>
--> — 行外のパラメータを持つコマンドを実行する</p></div><div class="refsynopsisdiv"><h2>概要</h2><pre class="synopsis">
int SPI_execute_extended(const char *<em class="parameter"><code>command</code></em>,
                         const SPIExecuteOptions * <em class="parameter"><code>options</code></em>)
</pre></div><div class="refsect1" id="id-1.8.12.8.6.5"><h2>説明</h2><!--
  <title>Description</title>
--><p>
<!--
   <function>SPI_execute_extended</function> executes a command that might
   include references to externally supplied parameters.  The command text
   refers to a parameter as <literal>$<replaceable>n</replaceable></literal>,
   and the <parameter>options-&gt;params</parameter> object (if supplied)
   provides values and type information for each such symbol.
   Various execution options can be specified
   in the <parameter>options</parameter> struct, too.
-->
<code class="function">SPI_execute_extended</code>は外部から供給されるパラメータへの参照を含むコマンドを実行します。
コマンドテキストはパラメータを<code class="literal">$<em class="replaceable"><code>n</code></em></code>として参照し、<em class="parameter"><code>options-&gt;params</code></em>オブジェクトは(供給されれば)こうしたシンボル毎にデータ型と値を提供します。
様々な実行オプションを<em class="parameter"><code>options</code></em>構造体にも指定できます。
  </p><p>
<!--
   The <parameter>options-&gt;params</parameter> object should normally
   mark each parameter with the <literal>PARAM_FLAG_CONST</literal> flag,
   since a one-shot plan is always used for the query.
-->
その問い合わせに対しては一度限りの計画が必ず使われますので、<em class="parameter"><code>options-&gt;params</code></em>オブジェクトは通常各パラメータに<code class="literal">PARAM_FLAG_CONST</code>フラグをつけるべきです。
  </p><p>
<!--
   If <parameter>options-&gt;dest</parameter> is not NULL, then result
   tuples are passed to that object as they are generated by the executor,
   instead of being accumulated in <varname>SPI_tuptable</varname>.  Using
   a caller-supplied <literal>DestReceiver</literal> object is particularly
   helpful for queries that might generate many tuples, since the data can
   be processed on-the-fly instead of being accumulated in memory.
-->
<em class="parameter"><code>options-&gt;dest</code></em>がNULLでなければ、結果タプルは、<code class="varname">SPI_tuptable</code>に蓄積される代わりに、エグゼキュータにより生成された時にそのオブジェクトに渡されます。
データがメモリに蓄積される代わりにその場で処理されるので、呼び出し元が提供する<code class="literal">DestReceiver</code>オブジェクトを使うことは、多数のタプルを生成する問い合わせに対して特に有用です。
  </p></div><div class="refsect1" id="id-1.8.12.8.6.6"><h2>引数</h2><!--
  <title>Arguments</title>
--><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">const char * <em class="parameter"><code>command</code></em></code></span></dt><dd><p>
<!--
      command string
-->
コマンド文字列
     </p></dd><dt><span class="term"><code class="literal">const SPIExecuteOptions * <em class="parameter"><code>options</code></em></code></span></dt><dd><p>
<!--
      struct containing optional arguments
-->
オプションの引数を含む構造体
     </p></dd></dl></div><p>
<!--
   Callers should always zero out the entire <parameter>options</parameter>
   struct, then fill whichever fields they want to set.  This ensures forward
   compatibility of code, since any fields that are added to the struct in
   future will be defined to behave backwards-compatibly if they are zero.
   The currently available <parameter>options</parameter> fields are:
-->
呼び出し元は、必ず<em class="parameter"><code>options</code></em>構造体全体をゼロクリアしてから、設定したいフィールドを埋めるべきです。
構造体に将来追加されるフィールドは、ゼロであれば後方互換性があるように振る舞うよう定義されますので、これはコードの将来の互換性を確実にします。
現在利用可能な<em class="parameter"><code>options</code></em>フィールドは以下の通りです。
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ParamListInfo <em class="parameter"><code>params</code></em></code></span></dt><dd><p>
<!--
      data structure containing query parameter types and values; NULL if none
-->
問い合わせパラメータの型と値を含むデータ構造。なければNULL
     </p></dd><dt><span class="term"><code class="literal">bool <em class="parameter"><code>read_only</code></em></code></span></dt><dd><!--
     <para><literal>true</literal> for read-only execution</para>
--><p>読み取りのみの実行の場合<code class="literal">true</code></p></dd><dt><span class="term"><code class="literal">bool <em class="parameter"><code>allow_nonatomic</code></em></code></span></dt><dd><p>
<!--
      <literal>true</literal> allows non-atomic execution of CALL and DO
      statements
-->
<code class="literal">true</code>でCALLとDO文の非原子的実行を許可します
     </p></dd><dt><span class="term"><code class="literal">bool <em class="parameter"><code>must_return_tuples</code></em></code></span></dt><dd><p>
<!--
      if <literal>true</literal>, raise error if the query is not of a kind
      that returns tuples (this does not forbid the case where it happens to
      return zero tuples)
-->
<code class="literal">true</code>であれば、問い合わせがタプルを返す種類のものでない場合にエラーを発生します(これはたまたま0個のタプルを返す場合を禁止しません)
     </p></dd><dt><span class="term"><code class="literal">uint64 <em class="parameter"><code>tcount</code></em></code></span></dt><dd><p>
<!--
      maximum number of rows to return,
      or <literal>0</literal> for no limit
-->
返される行の最大数、無制限の場合には<code class="literal">0</code>
     </p></dd><dt><span class="term"><code class="literal">DestReceiver * <em class="parameter"><code>dest</code></em></code></span></dt><dd><p>
<!--
      <literal>DestReceiver</literal> object that will receive any tuples
      emitted by the query; if NULL, result tuples are accumulated into
      a <varname>SPI_tuptable</varname> structure, as
      in <function>SPI_execute</function>
-->
問い合わせが出すタプルを受け取る<code class="literal">DestReceiver</code>オブジェクト。
NULLなら、<code class="function">SPI_execute</code>のように、結果タプルは<code class="varname">SPI_tuptable</code>構造体に蓄積されます。
     </p></dd><dt><span class="term"><code class="literal">ResourceOwner <em class="parameter"><code>owner</code></em></code></span></dt><dd><p>
<!--
      This field is present for consistency
      with <function>SPI_execute_plan_extended</function>, but it is
      ignored, since the plan used
      by <function>SPI_execute_extended</function> is never saved.
-->
このフィールドは<code class="function">SPI_execute_plan_extended</code>との一貫性のために存在しますが、無視されます。<code class="function">SPI_execute_extended</code>が使う計画は決して保存されないからです。
     </p></dd></dl></div></div><div class="refsect1" id="id-1.8.12.8.6.7"><h2>戻り値</h2><!--
  <title>Return Value</title>
--><p>
<!--
   The return value is the same as for <function>SPI_execute</function>.
-->
戻り値は<code class="function">SPI_execute</code>と同じです。
  </p><p>
<!--
   When <parameter>options-&gt;dest</parameter> is NULL,
   <varname>SPI_processed</varname> and
   <varname>SPI_tuptable</varname> are set as in
   <function>SPI_execute</function>.
   When <parameter>options-&gt;dest</parameter> is not NULL,
   <varname>SPI_processed</varname> is set to zero and
   <varname>SPI_tuptable</varname> is set to NULL.  If a tuple count
   is required, the caller's <literal>DestReceiver</literal> object must
   calculate it.
-->
<em class="parameter"><code>options-&gt;dest</code></em>がNULLであれば、<code class="varname">SPI_processed</code>と<code class="varname">SPI_tuptable</code>は<code class="function">SPI_execute</code>と同様に設定されます。
<em class="parameter"><code>options-&gt;dest</code></em>がNULLでなければ、<code class="varname">SPI_processed</code>はゼロに設定され、<code class="varname">SPI_tuptable</code>はNULLに設定されます。
タプルの集計が必要なら、呼び出し元の<code class="literal">DestReceiver</code>オブジェクトが計算しなければなりません。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spi-spi-exec.html" title="SPI_exec">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="spi-interface.html" title="47.1. インタフェース関数">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="spi-spi-execute-with-args.html" title="SPI_execute_with_args">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">SPI_exec </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 15.4文書">ホーム</a></td><td width="40%" align="right" valign="top"> SPI_execute_with_args</td></tr></table></div></body></html>