<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>39.2. データ変更の可視性</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="trigger-definition.html" title="39.1. トリガ動作の概要" /><link rel="next" href="trigger-interface.html" title="39.3. Cによるトリガ関数の作成" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /><style type="text/css"><!--
h1.TITLE {clear:both;}
.versions {
  float:right;
  margin-top:-0.2em;
  margin-bottom:0.5em;
  width: auto;
  padding:0.4em 1em;
  border:solid 1px #e0e0e0;
  border-radius:0.5em;
  background:#f3f3f3;
  background-image:-webkit-linear-gradient(#fbfbfb, #ebebeb);
  background-image:-moz-linear-gradient(#fbfbfb, #ebebeb);
  background-image:-o-linear-gradient(#fbfbfb, #ebebeb);
  background-image:linear-gradient(#fbfbfb, #ebebeb);
  box-shadow:0 3px 8px -3px #000;
}
.versions .label {
  cursor:pointer;
}
.versions .label:hover {
  text-decoration:underline;
}
.versions .list {
  display:none;
}
.versions .list-toggle {
  display:inline;
}
.versions .me {
  padding:0 0.2em;
  border:solid 2px #e88;
  border-radius:0.3em;
  background:#fbfbfb;
  font-weight:bold;
}
.versions .other {
  font-weight:bold;
}
.versions .unsup {
  color:#aaa;
}
.versions .unsup a {
  color:#aaa;
}

@media print {
  a {
    color: inherit;
    text-decoration: none;
  }
  a:visited {
    color: inherit;
  }
  .NAVHEADER, .versions, .NAVFOOTER {
    display: none;
  }
}
--></style><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript"><!--
  $(function(){
      $(".versions .label").bind("click", function(){
          $(".versions .list").toggleClass("list-toggle");
      })
  });
--></script></head><body id="docContent" class="container-fluid col-10"><div class="versions"><span class="label">他のバージョンの文書</span> <span class="list">： <span class="me">15</span> | <span class="other"><a href="/document/14/html/trigger-datachanges.html">14</a><span> | <span class="other"><a href="/document/13/html/trigger-datachanges.html">13</a><span> | <span class="other"><a href="/document/12/html/trigger-datachanges.html">12</a><span> | <span class="other"><a href="/document/11/html/trigger-datachanges.html">11</a><span> | <span class="other"><a href="/document/10/html/trigger-datachanges.html">10</a><span> | <span class="other"><a href="/document/9.6/html/trigger-datachanges.html">9.6</a><span> | <span class="other"><a href="/document/9.5/html/trigger-datachanges.html">9.5</a><span> | <span class="other"><a href="/document/9.4/html/trigger-datachanges.html">9.4</a><span> | <span class="other"><a href="/document/9.3/html/trigger-datachanges.html">9.3</a><span> | <span class="other"><a href="/document/9.2/html/trigger-datachanges.html">9.2</a><span> | <span class="other"><a href="/document/9.1/html/trigger-datachanges.html">9.1</a><span> | <span class="other"><a href="/document/9.0/html/trigger-datachanges.html">9.0</a><span> | <span class="other"><a href="/document/8.4/html/trigger-datachanges.html">8.4</a><span> | <span class="other"><a href="/document/8.3/html/trigger-datachanges.html">8.3</a><span> | <span class="other"><a href="/document/8.2/html/trigger-datachanges.html">8.2</a><span> | <span class="other"><a href="/document/8.1/html/trigger-datachanges.html">8.1</a><span> | <span class="other"><a href="/document/8.0/html/trigger-datachanges.html">8.0</a><span> | <span class="other"><a href="/document/7.4/html/trigger-datachanges.html">7.4</a><span> | <span class="other"><a href="/document/7.3/programmer/trigger-datachanges.html">7.3</a></span> | <span class="other"><a href="/document/7.2/programmer/trigger-datachanges.html">7.2</a></span></span></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 15.4文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="triggers.html" title="第39章 トリガ">第39章 トリガ</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="trigger-definition.html" title="39.1. トリガ動作の概要">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="triggers.html" title="第39章 トリガ">上へ</a></td><td width="60%" align="center">39.2. データ変更の可視性</td><td width="20%" align="right"> <a accesskey="n" href="trigger-interface.html" title="39.3. Cによるトリガ関数の作成">次へ</a></td></tr></table><hr /></div><div class="sect1" id="TRIGGER-DATACHANGES"><div class="titlepage"><div><div><h2 class="title" style="clear: both">39.2. データ変更の可視性</h2></div></div></div><!--
   <title>Visibility of Data Changes</title>
--><p>
<!--
    If you execute SQL commands in your trigger function, and these
    commands access the table that the trigger is for, then
    you need to be aware of the data visibility rules, because they determine
    whether these SQL commands will see the data change that the trigger
    is fired for.  Briefly:
-->
トリガ関数内でSQLコマンドを実行し、このコマンドがトリガの元となったテーブルにアクセスする場合、データの可視性規則に注意する必要があります。
この規則が、SQLコマンドがトリガの発行原因となったデータ変更を見ることができるかどうかを決定するからです。
簡単に以下に示します。

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
<!--
       Statement-level triggers follow simple visibility rules: none of
       the changes made by a statement are visible to statement-level
       <literal>BEFORE</literal> triggers, whereas all
       modifications are visible to statement-level <literal>AFTER</literal>
       triggers.
-->
文レベルトリガは次に示す簡単な可視性規則に従います。
文によってなされた変更は、文レベルの<code class="literal">BEFORE</code>トリガでは不可視です。
一方、文レベルの<code class="literal">AFTER</code>トリガでは全ての変更が可視です。
      </p></li><li class="listitem"><p>
<!--
       The data change (insertion, update, or deletion) causing the
       trigger to fire is naturally <emphasis>not</emphasis> visible
       to SQL commands executed in a row-level <literal>BEFORE</literal> trigger,
       because it hasn't happened yet.
-->
当然ながら行レベルの<code class="literal">BEFORE</code>トリガ内のSQLコマンドでは、トリガの発生原因となったデータ変更（挿入、更新、削除）はまだ発生していませんので、可視<span class="emphasis"><em>ではありません</em></span>。
      </p></li><li class="listitem"><p>
<!--
       However, SQL commands executed in a row-level <literal>BEFORE</literal>
       trigger <emphasis>will</emphasis> see the effects of data
       changes for rows previously processed in the same outer
       command.  This requires caution, since the ordering of these
       change events is not in general predictable; an SQL command that
       affects multiple rows can visit the rows in any order.
-->
しかし、行レベルの<code class="literal">BEFORE</code>トリガで実行されるSQLコマンドは、その外側のコマンドで以前に処理された行へのデータ変更の影響を見る<span class="emphasis"><em>ことになるでしょう</em></span>。
これらの変更イベントの順序は一般的に予測できませんので、注意が必要です。
複数行に影響するSQLコマンドはどのような順番でもその行を更新することができます。
      </p></li><li class="listitem"><p>
<!--
       Similarly, a row-level <literal>INSTEAD OF</literal> trigger will see the
       effects of data changes made by previous firings of <literal>INSTEAD
       OF</literal> triggers in the same outer command.
-->
同様に、行レベルの<code class="literal">INSTEAD OF</code>トリガは、同じ外側のコマンドで以前に処理された<code class="literal">INSTEAD OF</code>トリガよる変更結果を見ることになるでしょう。
      </p></li><li class="listitem"><p>
<!--
       When a row-level <literal>AFTER</literal> trigger is fired, all data
       changes made
       by the outer command are already complete, and are visible to
       the invoked trigger function.
-->
行レベルの<code class="literal">AFTER</code>トリガが発生すると、その外側のコマンドによってなされた全ての変更は既に完了していますので、呼び出されたトリガ関数から可視になります。
      </p></li></ul></div><p>
   </p><p>
<!--
    If your trigger function is written in any of the standard procedural
    languages, then the above statements apply only if the function is
    declared <literal>VOLATILE</literal>.  Functions that are declared
    <literal>STABLE</literal> or <literal>IMMUTABLE</literal> will not see changes made by
    the calling command in any case.
-->
もし、あなたのトリガが標準的な手続き型言語のいずれかで記述されている時、上記の可視性は関数が<code class="literal">VOLATILE</code>で定義されている場合のみ適用されます。
<code class="literal">STABLE</code>、もしくは<code class="literal">IMMUTABLE</code>で定義されている関数は、どのようなケースにおいても、呼び出しコマンドによる変更は見ないでしょう。
   </p><p>
<!--
    Further information about data visibility rules can be found in
    <xref linkend="spi-visibility"/>.  The example in <xref
    linkend="trigger-example"/> contains a demonstration of these rules.
-->
データ可視性規則に関する詳細は<a class="xref" href="spi-visibility.html" title="47.5. データ変更の可視性">47.5</a>にあります。
<a class="xref" href="trigger-example.html" title="39.4. 完全なトリガの例">39.4</a>の例にこの規則を示します。
   </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="trigger-definition.html" title="39.1. トリガ動作の概要">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="triggers.html" title="第39章 トリガ">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="trigger-interface.html" title="39.3. Cによるトリガ関数の作成">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">39.1. トリガ動作の概要 </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 15.4文書">ホーム</a></td><td width="40%" align="right" valign="top"> 39.3. Cによるトリガ関数の作成</td></tr></table></div></body></html>