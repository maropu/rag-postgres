<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第47章 サーバプログラミングインタフェース</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="plpython-envar.html" title="46.11. 環境変数" /><link rel="next" href="spi-interface.html" title="47.1. インタフェース関数" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /><style type="text/css"><!--
h1.TITLE {clear:both;}
.versions {
  float:right;
  margin-top:-0.2em;
  margin-bottom:0.5em;
  width: auto;
  padding:0.4em 1em;
  border:solid 1px #e0e0e0;
  border-radius:0.5em;
  background:#f3f3f3;
  background-image:-webkit-linear-gradient(#fbfbfb, #ebebeb);
  background-image:-moz-linear-gradient(#fbfbfb, #ebebeb);
  background-image:-o-linear-gradient(#fbfbfb, #ebebeb);
  background-image:linear-gradient(#fbfbfb, #ebebeb);
  box-shadow:0 3px 8px -3px #000;
}
.versions .label {
  cursor:pointer;
}
.versions .label:hover {
  text-decoration:underline;
}
.versions .list {
  display:none;
}
.versions .list-toggle {
  display:inline;
}
.versions .me {
  padding:0 0.2em;
  border:solid 2px #e88;
  border-radius:0.3em;
  background:#fbfbfb;
  font-weight:bold;
}
.versions .other {
  font-weight:bold;
}
.versions .unsup {
  color:#aaa;
}
.versions .unsup a {
  color:#aaa;
}

@media print {
  a {
    color: inherit;
    text-decoration: none;
  }
  a:visited {
    color: inherit;
  }
  .NAVHEADER, .versions, .NAVFOOTER {
    display: none;
  }
}
--></style><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript"><!--
  $(function(){
      $(".versions .label").bind("click", function(){
          $(".versions .list").toggleClass("list-toggle");
      })
  });
--></script></head><body id="docContent" class="container-fluid col-10"><div class="versions"><span class="label">他のバージョンの文書</span> <span class="list">： <span class="me">15</span> | <span class="other"><a href="/document/14/html/spi.html">14</a><span> | <span class="other"><a href="/document/13/html/spi.html">13</a><span> | <span class="other"><a href="/document/12/html/spi.html">12</a><span> | <span class="other"><a href="/document/11/html/spi.html">11</a><span> | <span class="other"><a href="/document/10/html/spi.html">10</a><span> | <span class="other"><a href="/document/9.6/html/spi.html">9.6</a><span> | <span class="other"><a href="/document/9.5/html/spi.html">9.5</a><span> | <span class="other"><a href="/document/9.4/html/spi.html">9.4</a><span> | <span class="other"><a href="/document/9.3/html/spi.html">9.3</a><span> | <span class="other"><a href="/document/9.2/html/spi.html">9.2</a><span> | <span class="other"><a href="/document/9.1/html/spi.html">9.1</a><span> | <span class="other"><a href="/document/9.0/html/spi.html">9.0</a><span> | <span class="other"><a href="/document/8.4/html/spi.html">8.4</a><span> | <span class="other"><a href="/document/8.3/html/spi.html">8.3</a><span> | <span class="other"><a href="/document/8.2/html/spi.html">8.2</a><span> | <span class="other"><a href="/document/8.1/html/spi.html">8.1</a><span> | <span class="other"><a href="/document/8.0/html/spi.html">8.0</a><span> | <span class="other"><a href="/document/7.4/html/spi.html">7.4</a><span> | <span class="other"><a href="/document/7.3/programmer/spi.html">7.3</a></span> | <span class="other"><a href="/document/7.2/programmer/spi.html">7.2</a></span></span></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 15.4文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="server-programming.html" title="パート V. サーバプログラミング">パート V. サーバプログラミング</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="plpython-envar.html" title="46.11. 環境変数">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="server-programming.html" title="パート V. サーバプログラミング">上へ</a></td><td width="60%" align="center">第47章 サーバプログラミングインタフェース</td><td width="20%" align="right"> <a accesskey="n" href="spi-interface.html" title="47.1. インタフェース関数">次へ</a></td></tr></table><hr /></div><div class="chapter" id="SPI"><div class="titlepage"><div><div><h2 class="title">第47章 サーバプログラミングインタフェース</h2></div></div></div><div class="toc"><p><strong>目次</strong></p><dl class="toc"><dt><span class="sect1"><a href="spi-interface.html">47.1. インタフェース関数</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="spi-spi-connect.html">SPI_connect</a></span><span class="refpurpose"> — SPIマネージャにC関数を接続する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-finish.html">SPI_finish</a></span><span class="refpurpose"> — C関数をSPIマネージャから切断する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute.html">SPI_execute</a></span><span class="refpurpose"> — コマンドを実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-exec.html">SPI_exec</a></span><span class="refpurpose"> — 読み書きコマンドを実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute-extended.html">SPI_execute_extended</a></span><span class="refpurpose"> — 行外のパラメータを持つコマンドを実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute-with-args.html">SPI_execute_with_args</a></span><span class="refpurpose"> — 行外のパラメータを持つコマンドを実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-prepare.html">SPI_prepare</a></span><span class="refpurpose"> — 文を準備する。文の実行はまだ行わない</span></dt><dt><span class="refentrytitle"><a href="spi-spi-prepare-cursor.html">SPI_prepare_cursor</a></span><span class="refpurpose"> — 文を準備する。まだ実行は行わない</span></dt><dt><span class="refentrytitle"><a href="spi-spi-prepare-extended.html">SPI_prepare_extended</a></span><span class="refpurpose"> — 文を準備する。文の実行はまだ行わない</span></dt><dt><span class="refentrytitle"><a href="spi-spi-prepare-params.html">SPI_prepare_params</a></span><span class="refpurpose"> — 文を準備する。まだ実行は行わない</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getargcount.html">SPI_getargcount</a></span><span class="refpurpose"> — 
<code class="function">SPI_prepare</code>により準備した文に必要とされる引数の数を返す
  </span></dt><dt><span class="refentrytitle"><a href="spi-spi-getargtypeid.html">SPI_getargtypeid</a></span><span class="refpurpose"> — 
<code class="function">SPI_prepare</code>で準備された文で指定される引数のデータ型のOIDを返す
  </span></dt><dt><span class="refentrytitle"><a href="spi-spi-is-cursor-plan.html">SPI_is_cursor_plan</a></span><span class="refpurpose"> — 
<code class="function">SPI_prepare</code>で準備された文が<code class="function">SPI_cursor_open</code>で使用できる場合に<code class="symbol">true</code>を返す
  </span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute-plan.html">SPI_execute_plan</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で準備された文を実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute-plan-extended.html">SPI_execute_plan_extended</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で準備された文を実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute-plan-with-paramlist.html">SPI_execute_plan_with_paramlist</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で準備された文を実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execp.html">SPI_execp</a></span><span class="refpurpose"> — 読み書きモードで文を実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-open.html">SPI_cursor_open</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で作成された文を使用したカーソルを設定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-open-with-args.html">SPI_cursor_open_with_args</a></span><span class="refpurpose"> — 問い合わせとパラメータを使ってカーソルを設定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-open-with-paramlist.html">SPI_cursor_open_with_paramlist</a></span><span class="refpurpose"> — パラメータを使ってカーソルを設定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-parse-open.html">SPI_cursor_parse_open</a></span><span class="refpurpose"> — 問い合わせ文字列とパラメータを使ってカーソルを設定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-find.html">SPI_cursor_find</a></span><span class="refpurpose"> — 既存のカーソルを名前で検索する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-fetch.html">SPI_cursor_fetch</a></span><span class="refpurpose"> — カーソルから数行を取り出す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-move.html">SPI_cursor_move</a></span><span class="refpurpose"> — カーソルを移動する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-scroll-cursor-fetch.html">SPI_scroll_cursor_fetch</a></span><span class="refpurpose"> — カーソルから一部の行を取り出す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-scroll-cursor-move.html">SPI_scroll_cursor_move</a></span><span class="refpurpose"> — カーソルを移動する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-close.html">SPI_cursor_close</a></span><span class="refpurpose"> — カーソルを閉じる</span></dt><dt><span class="refentrytitle"><a href="spi-spi-keepplan.html">SPI_keepplan</a></span><span class="refpurpose"> — 準備済み文を保持する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-saveplan.html">SPI_saveplan</a></span><span class="refpurpose"> — 準備済み文を保存する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-register-relation.html">SPI_register_relation</a></span><span class="refpurpose"> — 短命の名前付きリレーションをSPIの問い合わせから名前で参照可能にする</span></dt><dt><span class="refentrytitle"><a href="spi-spi-unregister-relation.html">SPI_unregister_relation</a></span><span class="refpurpose"> — 短命の名前付きリレーションをSPIのレジストリから削除する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-register-trigger-data.html">SPI_register_trigger_data</a></span><span class="refpurpose"> — 短命のトリガーデータをSPIの問い合わせから利用可能にする</span></dt></dl></dd><dt><span class="sect1"><a href="spi-interface-support.html">47.2. インタフェースサポート関数</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="spi-spi-fname.html">SPI_fname</a></span><span class="refpurpose"> — 指定した列番号に対する列名を決定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-fnumber.html">SPI_fnumber</a></span><span class="refpurpose"> — 指定した列名から列番号を決定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getvalue.html">SPI_getvalue</a></span><span class="refpurpose"> — 指定された列の文字列値を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getbinval.html">SPI_getbinval</a></span><span class="refpurpose"> — 指定した列のバイナリ値を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-gettype.html">SPI_gettype</a></span><span class="refpurpose"> — 指定された列のデータ型名を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-gettypeid.html">SPI_gettypeid</a></span><span class="refpurpose"> — 指定された列のデータ型の<acronym class="acronym">OID</acronym>を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getrelname.html">SPI_getrelname</a></span><span class="refpurpose"> — 指定されたリレーションの名前を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getnspname.html">SPI_getnspname</a></span><span class="refpurpose"> — 指定されたリレーションの名前空間を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-result-code-string.html">SPI_result_code_string</a></span><span class="refpurpose"> — 文字列でエラーコードを返します</span></dt></dl></dd><dt><span class="sect1"><a href="spi-memory.html">47.3. メモリ管理</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="spi-spi-palloc.html">SPI_palloc</a></span><span class="refpurpose"> — 上位エグゼキュータコンテキスト内にメモリを割り当てる</span></dt><dt><span class="refentrytitle"><a href="spi-realloc.html">SPI_repalloc</a></span><span class="refpurpose"> — 上位エグゼキュータコンテキスト内にメモリを再割り当てる</span></dt><dt><span class="refentrytitle"><a href="spi-spi-pfree.html">SPI_pfree</a></span><span class="refpurpose"> — 上位エグゼキュータコンテキスト内のメモリを解放する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-copytuple.html">SPI_copytuple</a></span><span class="refpurpose"> — 上位エグゼキュータ内に行のコピーを作成する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-returntuple.html">SPI_returntuple</a></span><span class="refpurpose"> — Datumとしてタプルを返す準備をする</span></dt><dt><span class="refentrytitle"><a href="spi-spi-modifytuple.html">SPI_modifytuple</a></span><span class="refpurpose"> — 与えられた行の選択フィールドを置き換えた行を作成する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-freetuple.html">SPI_freetuple</a></span><span class="refpurpose"> — 上位エグゼキュータコンテキスト内に割り当てられた行を解放する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-freetupletable.html">SPI_freetuptable</a></span><span class="refpurpose"> — <code class="function">SPI_execute</code>や類似の関数によって生成された行セットを解放する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-freeplan.html">SPI_freeplan</a></span><span class="refpurpose"> — 以前に保存した準備済み文を解放する</span></dt></dl></dd><dt><span class="sect1"><a href="spi-transaction.html">47.4. トランザクション管理</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="spi-spi-commit.html">SPI_commit</a></span><span class="refpurpose"> — 現在のトランザクションをコミットします。</span></dt><dt><span class="refentrytitle"><a href="spi-spi-rollback.html">SPI_rollback</a></span><span class="refpurpose"> — 現在のトランザクションを中断します。</span></dt><dt><span class="refentrytitle"><a href="spi-spi-start-transaction.html">SPI_start_transaction</a></span><span class="refpurpose"> — 廃れた関数</span></dt></dl></dd><dt><span class="sect1"><a href="spi-visibility.html">47.5. データ変更の可視性</a></span></dt><dt><span class="sect1"><a href="spi-examples.html">47.6. 例</a></span></dt></dl></div><!--
 <title>Server Programming Interface</title>
--><a id="id-1.8.12.2" class="indexterm"></a><p>
<!--
  The <firstterm>Server Programming Interface</firstterm>
  (<acronym>SPI</acronym>) gives writers of user-defined
  <acronym>C</acronym> functions the ability to run
  <acronym>SQL</acronym> commands inside their functions or procedures.
  <acronym>SPI</acronym> is a set of
  interface functions to simplify access to the parser, planner,
  and executor. <acronym>SPI</acronym> also does some
  memory management.
-->
<em class="firstterm">サーバプログラミングインタフェース</em>（<acronym class="acronym">SPI</acronym>）は、ユーザ定義の<acronym class="acronym">C</acronym>関数が関数やプロシージャから<acronym class="acronym">SQL</acronym>コマンドを実行する機能をユーザに提供します。
<acronym class="acronym">SPI</acronym>はパーサ、プランナ、エグゼキュータへのアクセスを単純化したインタフェース関数の集合です。
また、<acronym class="acronym">SPI</acronym>は多少のメモリ管理を行います。
 </p><div class="note"><h3 class="title">注記</h3><p>
<!--
   The available procedural languages provide various means to
   execute SQL commands from functions.  Most of these facilities are
   based on SPI, so this documentation might be of use for users
   of those languages as well.
-->
利用可能な手続き言語は、関数からSQLコマンドを実行するための各種手段を提供します。
これらのほとんどは、SPIを基にしていますので、この文書はこれらの言語のユーザにとっても有用な場合があります。
  </p></div><p>
<!--
  Note that if a command invoked via SPI fails, then control will not be
  returned to your C function.  Rather, the
  transaction or subtransaction in which your C function executes will be
  rolled back.  (This might seem surprising given that the SPI functions mostly
  have documented error-return conventions.  Those conventions only apply
  for errors detected within the SPI functions themselves, however.)
  It is possible to recover control after an error by establishing your own
  subtransaction surrounding SPI calls that might fail.
-->
コマンドがSPIの失敗を起こした場合、その制御はC関数には戻らないことに注意してください。
それどころか、プロシージャを実行していたトランザクションもしくは副トランザクションはロールバックされます
（これはSPI関数のほとんどでエラーを返す規約があることから奇妙に思われるかもしれません。
しかし、こうした規約はSPI関数自身でエラーを検知した時にのみ適用されるものです）。
失敗する可能性があるSPI呼び出しを囲む副トランザクションを独自に用意することで、エラーの後の制御を戻すことができます。
 </p><p>
<!--
  <acronym>SPI</acronym> functions return a nonnegative result on
  success (either via a returned integer value or in the global
  variable <varname>SPI_result</varname>, as described below).  On
  error, a negative result or <symbol>NULL</symbol> will be returned.
-->
<acronym class="acronym">SPI</acronym>関数は成功時に非負の結果を（戻り値、もしくは後述の<code class="varname">SPI_result</code>グローバル変数の中に）返します。
エラー時、負の結果もしくは<code class="symbol">NULL</code>を返します。
 </p><p>
<!--
  Source code files that use SPI must include the header file
  <filename>executor/spi.h</filename>.
-->
SPIを使用するソースコードファイルでは<code class="filename">executor/spi.h</code>ヘッダファイルをincludeしなければなりません。
 </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="plpython-envar.html" title="46.11. 環境変数">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="server-programming.html" title="パート V. サーバプログラミング">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="spi-interface.html" title="47.1. インタフェース関数">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">46.11. 環境変数 </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 15.4文書">ホーム</a></td><td width="40%" align="right" valign="top"> 47.1. インタフェース関数</td></tr></table></div></body></html>